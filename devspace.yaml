version: v1beta6
images:
  assets-fixtures:
    image: shopozor/assets-fixtures
    tag: ${DEVSPACE_GIT_COMMIT}
    context: .
    dockerfile: backend/assets-service/Dockerfile
  api:
    image: shopozor/graphql-engine
    tag: ${DEVSPACE_GIT_COMMIT}
    context: backend/database-service
    dockerfile: backend/database-service/Dockerfile
    build:
      docker:
        options:
          target: hasura-migrations
  fixtures-service:
    image: shopozor/fixtures-service
    tag: ${DEVSPACE_GIT_COMMIT}
    context: .
    dockerfile: backend/fixtures-generator/Dockerfile
    build:
      docker:
        options:
          target: app
  admin-ui:
    image: shopozor/admin-ui
    tag: ${DEVSPACE_GIT_COMMIT}
    context: .
    dockerfile: Dockerfile
    build:
      docker:
        options:
          target: admin-ui
          buildArgs:
            GRAPHQL_API: http://api.shopozor/v1/graphql/
            ASSETS_API: http://assets.shopozor/
  consumer-ui:
    image: shopozor/consumer-ui-spa
    tag: ${DEVSPACE_GIT_COMMIT}
    context: .
    dockerfile: Dockerfile
    build:
      docker:
        options:
          target: consumer-ui-spa
          buildArgs:
            GRAPHQL_API: http://api.shopozor/v1/graphql/
            ASSETS_API: http://assets.shopozor/
  admin-storybook:
    image: shopozor/admin-storybook
    tag: ${DEVSPACE_GIT_COMMIT}
    context: .
    dockerfile: Dockerfile
    build:
      docker:
        options:
          target: admin-storybook
          buildArgs:
            ASSETS_API: http://assets.shopozor/
  consumer-storybook:
    image: shopozor/consumer-storybook
    tag: ${DEVSPACE_GIT_COMMIT}
    context: .
    dockerfile: Dockerfile
    build:
      docker:
        options:
          target: consumer-storybook
          buildArgs:
            ASSETS_API: http://assets.shopozor/
deployments:
- name: minio
  namespace: dev
  helm:
    componentChart: false
    chart:
      repo: https://charts.bitnami.com/bitnami
      name: minio
    values:
      ingress:
        enabled: true
        annotations:
          kubernetes.io/ingress.class: nginx
        hosts:
        - name: assets.shopozor
          path: /
      mode: standalone
      clusterDomain: localhost
      persistence:
        enabled: false
        size: 10Gi
      disableWebUI: false
      accessKey:
        password: minio
      secretKey:
        password: minio123
      service:
        port: 9000
# - name: services
#   helm:
#     chart:
#       name: ./backend/assets-service/chart
dev: {}
